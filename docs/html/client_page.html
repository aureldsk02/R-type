<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>R-TYPE: R-TYPE Client</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">R-TYPE
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">R-TYPE Client</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This page details how the client works.</p>
<h1><a class="anchor" id="global_infos"></a>
Global Explanation</h1>
<p>Since the real computings, simulations, updates happen in the server's registry, the client is then a simple displayer of the informations sent by the client. The client only listens for the game state from the server to display it. It also listens for player inputs and notifies the server about them.</p>
<h1><a class="anchor" id="game_state_sec"></a>
Game State Handling</h1>
<p>On each frame, the client looks up in its buffer to recuperate all the entities informations sent by the server. This vector of entities informations is considered as the new state. The client the compares the new state with the old one. If an entity is present in the old state as well as in the new one, we just update the position. If an entity is present only in the new state, it then needs to be created. And if an entity is only present in the old state, it needs to be destroyed. At the same time, the client listens for player key inputs. If an input is detected, the player sends the info to the server which will update the game state accordingly. See more details in init_client.cpp</p>
<h1><a class="anchor" id="network_details_sec"></a>
Network Details</h1>
<p>The client uses a <code>NetworkManager</code> instance to communicate with the server. This communication is done over <b>UDP</b> using the <b>ASIO</b> library, which provides asynchronous networking capabilities.</p>
<p>When the client starts, it creates a <code>NetworkManager</code> object by providing:</p><ul>
<li>the <b>port</b> on which to listen for incoming packets*,</li>
<li>the <b>server address</b> on with it will connect,</li>
<li>a reference to a shared <b>message buffer</b> (<code>lastmsg</code>) and a <b>mutex</b>.</li>
</ul>
<div class="fragment"><div class="line">Client::Client(<span class="keywordtype">int</span> port, std::string address, <a class="code hl_class" href="classregistry.html">registry</a>&amp; reg)</div>
<div class="line">    : port_(port),</div>
<div class="line">      client_(port, address, std::ref(lastmsg), std::ref(mtx)),</div>
<div class="line">      _reg(reg)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_function" href="init__graphicsClient_8cpp.html#a1957e9ebc2a88bc8e6c87fa64239c299">load_client_textures</a>();</div>
<div class="line">    initGame();</div>
<div class="line">}</div>
<div class="ttc" id="aclassregistry_html"><div class="ttname"><a href="classregistry.html">registry</a></div><div class="ttdoc">The registry class. The registry is a container for all the entities and components of the game....</div><div class="ttdef"><b>Definition</b> registry.hpp:63</div></div>
<div class="ttc" id="ainit__graphicsClient_8cpp_html_a1957e9ebc2a88bc8e6c87fa64239c299"><div class="ttname"><a href="init__graphicsClient_8cpp.html#a1957e9ebc2a88bc8e6c87fa64239c299">load_client_textures</a></div><div class="ttdeci">void load_client_textures(void)</div><div class="ttdoc">This function uses the ResourceManager to pre-load textures and fonts that will be used in the game.</div><div class="ttdef"><b>Definition</b> init_graphicsClient.cpp:33</div></div>
</div><!-- fragment --><p>The constructor of <code>NetworkManager</code> immediately calls <code>receive_from_server()</code>, which starts an asynchronous loop that listens for incoming data from the server.</p>
<p>The client constantly listens for messages from the server through:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> NetworkManager::receive_from_server();</div>
</div><!-- fragment --><p>Each time data is received, it is written into the <code>lastmsg</code> buffer inside a mutex-locked scope to ensure thread safety. This buffer will later be parsed by the game logic to reconstruct the current state of all entities.</p>
<p>The asynchronous call automatically restarts itself after each reception as long as the client is running (<code>isrunning == true</code>).</p>
<p>To send information to the server (for example, when a player presses a key), the client uses:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> NetworkManager::send_to_server(<span class="keyword">const</span> std::vector&lt;int8_t&gt;&amp; msg, <span class="keywordtype">size_t</span> size);</div>
</div><!-- fragment --><p>This method sends a UDP packet to the server’s endpoint. The data structure is simple — it's a <code>std::vector&lt;int8_t&gt;</code></p>
<p>The sending is also <b>asynchronous</b>, meaning the game loop never blocks on network operations. The ASIO context runs in a dedicated thread:</p>
<div class="fragment"><div class="line">std::thread t([&amp;c]() { c.run(); });</div>
</div><!-- fragment --><p>The client uses a <b>multi-threaded</b> model:</p><ul>
<li>The main thread handles the SFML window, input events, and rendering.</li>
<li>The ASIO thread handles all network I/O operations.</li>
</ul>
<p>These two threads communicate through shared buffers (<code>lastmsg</code>) protected by a <code>std::mutex</code> to avoid bad utilisation.</p>
<ul>
<li>Communication protocol: <b>UDP</b></li>
<li>Network library: <b>ASIO (Boost.Asio-like)</b></li>
<li>Sending: asynchronous, non-blocking</li>
<li>Receiving: asynchronous loop</li>
<li>Data format: <code>std::vector&lt;int8_t&gt;</code></li>
<li>Synchronization: <code>std::mutex</code> around message buffers </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
